# WireGuard Web UI Dockerfile - 简化版本
FROM python:3.11-slim

LABEL maintainer="WireGuard Manager"
LABEL description="WireGuard Web Management Interface"

# 设置环境变量
ENV PYTHONUNBUFFERED=1
ENV FLASK_APP=app.py
ENV WEB_PORT=8080

# 安装系统依赖
RUN apt-get update && apt-get install -y \
    qrencode \
    sudo \
    iproute2 \
    iptables \
    wireguard-tools \
    curl \
    && apt-get clean \
    && rm -rf /var/lib/apt/lists/*

# 创建工作目录
WORKDIR /app

# 复制 requirements
COPY web/requirements.txt /app/requirements.txt

# 安装 Python 依赖
RUN pip install --no-cache-dir -r requirements.txt

# 复制应用文件
COPY web/app.py /app/app.py
COPY web/templates/ /app/templates/

# 创建启动脚本
COPY docker/entrypoint-web.sh /entrypoint.sh
RUN chmod +x /entrypoint.sh

# 暴露端口
EXPOSE 8080

# 启动应用
ENTRYPOINT ["/entrypoint.sh"]
CMD ["python", "app.py"]